name: Workflow Summary

on:
  workflow_run:
    workflows: ["CI", "Code Quality", "Security & Dependencies"]
    types: [completed]
  schedule:
    # Daily summary at 6 AM UTC
    - cron: '0 6 * * *'
  workflow_dispatch:

jobs:
  summary:
    runs-on: ubuntu-latest

    steps:
    - name: Generate workflow summary
      run: |
        echo "# ðŸš€ AI-driven Python Code - Workflow Status Summary" > $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ðŸ“Š Latest Workflow Status" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Workflow | Status | Last Run |" >> $GITHUB_STEP_SUMMARY
        echo "|----------|--------|----------|" >> $GITHUB_STEP_SUMMARY
        echo "| CI | âœ… Active | Latest commit |" >> $GITHUB_STEP_SUMMARY
        echo "| Code Quality | âœ… Active | Latest commit |" >> $GITHUB_STEP_SUMMARY
        echo "| Security & Dependencies | âœ… Active | Scheduled/Latest commit |" >> $GITHUB_STEP_SUMMARY
        echo "| Release | ðŸ•’ On-demand | Tag creation |" >> $GITHUB_STEP_SUMMARY
        echo "| Dependency Updates | ðŸ”„ Monthly | Automated |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ðŸ›¡ï¸ Security & Quality" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **Code Quality**: Automated linting, formatting, and style checks" >> $GITHUB_STEP_SUMMARY
        echo "- **Security Scanning**: Bandit, Safety, Semgrep, and CodeQL" >> $GITHUB_STEP_SUMMARY
        echo "- **Dependency Management**: Automated updates and vulnerability scanning" >> $GITHUB_STEP_SUMMARY
        echo "- **License Compliance**: Automated license tracking" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ðŸ”§ Available Actions" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **Manual Dependency Check**: Trigger dependency update workflow" >> $GITHUB_STEP_SUMMARY
        echo "- **Release**: Create a new tag to trigger release workflow" >> $GITHUB_STEP_SUMMARY
        echo "- **Security Scan**: Manual security scanning" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ðŸ“ˆ Project Health" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… **CI**: All Python versions (3.8-3.11) tested" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… **Build**: Package building and validation" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… **Quality**: Code style and documentation checks" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… **Security**: Multi-tool security analysis" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "*Generated on $(date)*" >> $GITHUB_STEP_SUMMARY

    - name: Check repository health
      run: |
        echo "## ðŸ” Repository Health Check" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # Check if key files exist
        if [ -f "requirements.txt" ]; then
          echo "- âœ… Requirements file exists" >> $GITHUB_STEP_SUMMARY
        else
          echo "- âŒ Requirements file missing" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [ -f "README.md" ]; then
          echo "- âœ… README documentation exists" >> $GITHUB_STEP_SUMMARY
        else
          echo "- âŒ README documentation missing" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [ -f "LICENSE" ]; then
          echo "- âœ… License file exists" >> $GITHUB_STEP_SUMMARY
        else
          echo "- âŒ License file missing" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [ -d ".github/workflows" ]; then
          WORKFLOW_COUNT=$(find .github/workflows -name "*.yml" | wc -l)
          echo "- âœ… GitHub Actions configured ($WORKFLOW_COUNT workflows)" >> $GITHUB_STEP_SUMMARY
        else
          echo "- âŒ GitHub Actions not configured" >> $GITHUB_STEP_SUMMARY
        fi